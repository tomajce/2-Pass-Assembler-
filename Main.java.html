<html>
<head>
<title>Main.java</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6a8759;}
.s3 { color: #6897bb;}
.s4 { color: #808080;}
</style>
</head>
<body bgcolor="#171717">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
Main.java</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">javax.swing.*</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">java.io.IOException</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">java.io.*</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">java.util.HashMap</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">java.util.LinkedHashMap</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">java.util.Map</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">java.awt.*</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">java.io.File</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">java.io.InputStream</span><span class="s0">;</span>

<span class="s0">class </span><span class="s1">ModifiedTwoPassAssemblerGUI </span><span class="s0">extends </span><span class="s1">JFrame {</span>
    <span class="s0">private final </span><span class="s1">JTextField inputFileField</span><span class="s0">;</span>
    <span class="s0">private final </span><span class="s1">JTextField optabFileField</span><span class="s0">;</span>
    <span class="s0">private final </span><span class="s1">JButton assembleBtn</span><span class="s0">;</span>
    <span class="s0">private final </span><span class="s1">JTextArea intermediateFileOutput</span><span class="s0">;</span>
    <span class="s0">private final </span><span class="s1">JTextArea symbolTableOutput</span><span class="s0">;</span>
    <span class="s0">private final </span><span class="s1">JTextArea objectCodeOutput</span><span class="s0">;</span>

    <span class="s0">public </span><span class="s1">ModifiedTwoPassAssemblerGUI() </span><span class="s0">throws </span><span class="s1">IOException {</span>
        <span class="s1">setTitle(</span><span class="s2">&quot;Enhanced Two-Pass Assembler&quot;</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s1">setSize(</span><span class="s3">850</span><span class="s0">, </span><span class="s3">700</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s1">setResizable(</span><span class="s0">false</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s1">setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE)</span><span class="s0">;</span>

        <span class="s1">Font font = </span><span class="s0">new </span><span class="s1">Font(</span><span class="s2">&quot;Verdana&quot;</span><span class="s0">, </span><span class="s1">Font.BOLD</span><span class="s0">, </span><span class="s3">14</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s1">Font monospacedFont = </span><span class="s0">new </span><span class="s1">Font(</span><span class="s2">&quot;Monospaced&quot;</span><span class="s0">, </span><span class="s1">Font.PLAIN</span><span class="s0">, </span><span class="s3">14</span><span class="s1">)</span><span class="s0">;</span>

        <span class="s4">// Input label and field with updated layout</span>
        <span class="s1">JLabel inputFileLabel = </span><span class="s0">new </span><span class="s1">JLabel(</span><span class="s2">&quot;Assembly Source File:&quot;</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s1">inputFileLabel.setFont(font)</span><span class="s0">;</span>
        <span class="s1">inputFileField = </span><span class="s0">new </span><span class="s1">JTextField(</span><span class="s3">28</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s1">inputFileField.setFont(font)</span><span class="s0">;</span>
        <span class="s1">JButton browseBtn = </span><span class="s0">new </span><span class="s1">JButton(</span><span class="s2">&quot;Browse File&quot;</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s1">browseBtn.setFont(font)</span><span class="s0">;</span>
        <span class="s1">browseBtn.setBackground(</span><span class="s0">new </span><span class="s1">Color(</span><span class="s3">30</span><span class="s0">, </span><span class="s3">144</span><span class="s0">, </span><span class="s3">255</span><span class="s1">))</span><span class="s0">;</span>
        <span class="s1">browseBtn.setForeground(Color.WHITE)</span><span class="s0">;</span>
        <span class="s1">browseBtn.addActionListener(e -&gt; browseFile(inputFileField))</span><span class="s0">;</span>

        <span class="s4">// Input panel with slightly different layout</span>
        <span class="s1">JPanel inputPanel = </span><span class="s0">new </span><span class="s1">JPanel(</span><span class="s0">new </span><span class="s1">FlowLayout(FlowLayout.LEFT</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s3">10</span><span class="s1">))</span><span class="s0">;</span>
        <span class="s1">inputPanel.setBorder(BorderFactory.createTitledBorder(</span><span class="s2">&quot;Input File&quot;</span><span class="s1">))</span><span class="s0">;</span>
        <span class="s1">inputPanel.add(inputFileLabel)</span><span class="s0">;</span>
        <span class="s1">inputPanel.add(inputFileField)</span><span class="s0">;</span>
        <span class="s1">inputPanel.add(browseBtn)</span><span class="s0">;</span>

        <span class="s4">// Optab label and field with enhanced look</span>
        <span class="s1">JLabel optabFileLabel = </span><span class="s0">new </span><span class="s1">JLabel(</span><span class="s2">&quot;Opcode Table File:&quot;</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s1">optabFileLabel.setFont(font)</span><span class="s0">;</span>
        <span class="s1">optabFileField = </span><span class="s0">new </span><span class="s1">JTextField(</span><span class="s3">28</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s1">optabFileField.setFont(font)</span><span class="s0">;</span>
        <span class="s1">JButton optabBrowseBtn = </span><span class="s0">new </span><span class="s1">JButton(</span><span class="s2">&quot;Browse File&quot;</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s1">optabBrowseBtn.setFont(font)</span><span class="s0">;</span>
        <span class="s1">optabBrowseBtn.setBackground(</span><span class="s0">new </span><span class="s1">Color(</span><span class="s3">30</span><span class="s0">, </span><span class="s3">144</span><span class="s0">, </span><span class="s3">255</span><span class="s1">))</span><span class="s0">;</span>
        <span class="s1">optabBrowseBtn.setForeground(Color.WHITE)</span><span class="s0">;</span>
        <span class="s1">optabBrowseBtn.addActionListener(e -&gt; browseFile(optabFileField))</span><span class="s0">;</span>

        <span class="s4">// Opcode panel layout update</span>
        <span class="s1">JPanel optabPanel = </span><span class="s0">new </span><span class="s1">JPanel(</span><span class="s0">new </span><span class="s1">FlowLayout(FlowLayout.LEFT</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s3">10</span><span class="s1">))</span><span class="s0">;</span>
        <span class="s1">optabPanel.setBorder(BorderFactory.createTitledBorder(</span><span class="s2">&quot;Optab File&quot;</span><span class="s1">))</span><span class="s0">;</span>
        <span class="s1">optabPanel.add(optabFileLabel)</span><span class="s0">;</span>
        <span class="s1">optabPanel.add(optabFileField)</span><span class="s0">;</span>
        <span class="s1">optabPanel.add(optabBrowseBtn)</span><span class="s0">;</span>

        <span class="s4">// Assemble button updated with new color and style</span>
        <span class="s1">assembleBtn = </span><span class="s0">new </span><span class="s1">JButton(</span><span class="s2">&quot;Assemble Code&quot;</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s1">assembleBtn.setFont(</span><span class="s0">new </span><span class="s1">Font(</span><span class="s2">&quot;Verdana&quot;</span><span class="s0">, </span><span class="s1">Font.BOLD</span><span class="s0">, </span><span class="s3">16</span><span class="s1">))</span><span class="s0">;</span>
        <span class="s1">assembleBtn.setBackground(</span><span class="s0">new </span><span class="s1">Color(</span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s0">, </span><span class="s3">0</span><span class="s1">))</span><span class="s0">;</span>
        <span class="s1">assembleBtn.setForeground(Color.WHITE)</span><span class="s0">;</span>
        <span class="s1">assembleBtn.setFocusPainted(</span><span class="s0">false</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s1">assembleBtn.setPreferredSize(</span><span class="s0">new </span><span class="s1">Dimension(</span><span class="s3">175</span><span class="s0">, </span><span class="s3">40</span><span class="s1">))</span><span class="s0">;</span>
        <span class="s1">assembleBtn.setHorizontalAlignment(SwingConstants.RIGHT)</span><span class="s0">;</span>
        <span class="s1">assembleBtn.addActionListener(e -&gt; runAssembler())</span><span class="s0">;</span>

        <span class="s4">// Panel for Assemble button with centered layout</span>
        <span class="s1">JPanel buttonPanel = </span><span class="s0">new </span><span class="s1">JPanel(</span><span class="s0">new </span><span class="s1">FlowLayout(FlowLayout.RIGHT))</span><span class="s0">;</span>
        <span class="s1">buttonPanel.add(assembleBtn)</span><span class="s0">;</span>

        <span class="s4">// Text areas for displaying outputs with some layout changes</span>
        <span class="s1">intermediateFileOutput = </span><span class="s0">new </span><span class="s1">JTextArea(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">30</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s1">intermediateFileOutput.setBorder(BorderFactory.createTitledBorder(</span><span class="s2">&quot;Intermediate Code Output&quot;</span><span class="s1">))</span><span class="s0">;</span>
        <span class="s1">intermediateFileOutput.setFont(monospacedFont)</span><span class="s0">;</span>
        <span class="s1">intermediateFileOutput.setEditable(</span><span class="s0">false</span><span class="s1">)</span><span class="s0">;</span>

        <span class="s1">symbolTableOutput = </span><span class="s0">new </span><span class="s1">JTextArea(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">30</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s1">symbolTableOutput.setBorder(BorderFactory.createTitledBorder(</span><span class="s2">&quot;Symbol Table&quot;</span><span class="s1">))</span><span class="s0">;</span>
        <span class="s1">symbolTableOutput.setFont(monospacedFont)</span><span class="s0">;</span>
        <span class="s1">symbolTableOutput.setEditable(</span><span class="s0">false</span><span class="s1">)</span><span class="s0">;</span>

        <span class="s1">objectCodeOutput = </span><span class="s0">new </span><span class="s1">JTextArea(</span><span class="s3">8</span><span class="s0">, </span><span class="s3">91</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s1">objectCodeOutput.setBorder(BorderFactory.createTitledBorder(</span><span class="s2">&quot;Generated Object Code&quot;</span><span class="s1">))</span><span class="s0">;</span>
        <span class="s1">objectCodeOutput.setFont(monospacedFont)</span><span class="s0">;</span>
        <span class="s1">objectCodeOutput.setEditable(</span><span class="s0">false</span><span class="s1">)</span><span class="s0">;</span>

        <span class="s4">// Adding scrollable text areas</span>
        <span class="s1">JPanel textAreaPanel = </span><span class="s0">new </span><span class="s1">JPanel(</span><span class="s0">new </span><span class="s1">GridLayout(</span><span class="s3">1</span><span class="s0">, </span><span class="s3">2</span><span class="s0">, </span><span class="s3">15</span><span class="s0">, </span><span class="s3">15</span><span class="s1">))</span><span class="s0">;</span>
        <span class="s1">textAreaPanel.setBorder(BorderFactory.createEmptyBorder(</span><span class="s3">15</span><span class="s0">, </span><span class="s3">20</span><span class="s0">, </span><span class="s3">15</span><span class="s0">, </span><span class="s3">20</span><span class="s1">))</span><span class="s0">;</span>
        <span class="s1">textAreaPanel.add(</span><span class="s0">new </span><span class="s1">JScrollPane(intermediateFileOutput))</span><span class="s0">;</span>
        <span class="s1">textAreaPanel.add(</span><span class="s0">new </span><span class="s1">JScrollPane(symbolTableOutput))</span><span class="s0">;</span>

        <span class="s1">JPanel bottomTextAreaPanel = </span><span class="s0">new </span><span class="s1">JPanel(</span><span class="s0">new </span><span class="s1">BorderLayout())</span><span class="s0">;</span>
        <span class="s1">bottomTextAreaPanel.setBorder(BorderFactory.createEmptyBorder(</span><span class="s3">15</span><span class="s0">, </span><span class="s3">20</span><span class="s0">, </span><span class="s3">15</span><span class="s0">, </span><span class="s3">20</span><span class="s1">))</span><span class="s0">;</span>
        <span class="s1">bottomTextAreaPanel.add(</span><span class="s0">new </span><span class="s1">JScrollPane(objectCodeOutput)</span><span class="s0">, </span><span class="s1">BorderLayout.CENTER)</span><span class="s0">;</span>

        <span class="s4">// Main panel to hold all components with more padding</span>
        <span class="s1">JPanel mainPanel = </span><span class="s0">new </span><span class="s1">JPanel()</span><span class="s0">;</span>
        <span class="s1">mainPanel.setLayout(</span><span class="s0">new </span><span class="s1">BoxLayout(mainPanel</span><span class="s0">, </span><span class="s1">BoxLayout.Y_AXIS))</span><span class="s0">;</span>
        <span class="s1">mainPanel.setBorder(BorderFactory.createEmptyBorder(</span><span class="s3">10</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s3">10</span><span class="s0">, </span><span class="s3">10</span><span class="s1">))</span><span class="s0">;</span>
        <span class="s1">mainPanel.add(inputPanel)</span><span class="s0">;</span>
        <span class="s1">mainPanel.add(optabPanel)</span><span class="s0">;</span>
        <span class="s1">mainPanel.add(buttonPanel)</span><span class="s0">;</span>
        <span class="s1">mainPanel.add(textAreaPanel)</span><span class="s0">;</span>
        <span class="s1">mainPanel.add(bottomTextAreaPanel)</span><span class="s0">;</span>

        <span class="s1">add(mainPanel</span><span class="s0">, </span><span class="s1">BorderLayout.CENTER)</span><span class="s0">;</span>

        <span class="s4">// Center the window on the screen</span>
        <span class="s1">setLocationRelativeTo(</span><span class="s0">null</span><span class="s1">)</span><span class="s0">;</span>
    <span class="s1">}</span>

    <span class="s4">// Browse file</span>
    <span class="s0">private void </span><span class="s1">browseFile(JTextField field) {</span>
        <span class="s1">JFileChooser fileChooser = </span><span class="s0">new </span><span class="s1">JFileChooser()</span><span class="s0">;</span>
        <span class="s0">int </span><span class="s1">option = fileChooser.showOpenDialog(</span><span class="s0">this</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s0">if </span><span class="s1">(option == JFileChooser.APPROVE_OPTION) {</span>
            <span class="s1">File file = fileChooser.getSelectedFile()</span><span class="s0">;</span>
            <span class="s1">field.setText(file.getPath())</span><span class="s0">;</span>
        <span class="s1">}</span>
    <span class="s1">}</span>

    <span class="s4">// Run the assembler</span>
    <span class="s0">private void </span><span class="s1">runAssembler() {</span>
        <span class="s1">String inputFile = inputFileField.getText()</span><span class="s0">;</span>
        <span class="s1">String optabFile = optabFileField.getText()</span><span class="s0">;</span>

        <span class="s0">if </span><span class="s1">(inputFile.isEmpty()) {</span>
            <span class="s1">JOptionPane.showMessageDialog(</span><span class="s0">this, </span><span class="s2">&quot;Input file is missing!&quot;</span><span class="s0">, </span><span class="s2">&quot;Error&quot;</span><span class="s0">, </span><span class="s1">JOptionPane.ERROR_MESSAGE)</span><span class="s0">;</span>
            <span class="s0">return;</span>
        <span class="s1">}</span>

        <span class="s1">assembleBtn.setEnabled(</span><span class="s0">false</span><span class="s1">)</span><span class="s0">;</span>

        <span class="s1">SwingWorker&lt;Void</span><span class="s0">, </span><span class="s1">Void&gt; worker = </span><span class="s0">new </span><span class="s1">SwingWorker&lt;&gt;() {</span>
            <span class="s1">@Override</span>
            <span class="s0">protected </span><span class="s1">Void doInBackground() {</span>
                <span class="s1">TwoPassAssembler assembler = </span><span class="s0">new </span><span class="s1">TwoPassAssembler(inputFile</span><span class="s0">, </span><span class="s1">optabFile)</span><span class="s0">;</span>
                <span class="s0">try </span><span class="s1">{</span>
                    <span class="s1">assembler.loadOptab()</span><span class="s0">;</span>
                    <span class="s1">assembler.passOne()</span><span class="s0">;</span>
                    <span class="s1">assembler.passTwo()</span><span class="s0">;</span>
                    <span class="s1">displayIntermediateCode(assembler.getIntermediate()</span><span class="s0">, </span><span class="s1">assembler.getIntermediateStart())</span><span class="s0">;</span>
                    <span class="s1">displaySymbolTable(assembler.getSymtab())</span><span class="s0">;</span>
                    <span class="s1">displayObjectCode(assembler.getObjectCode())</span><span class="s0">;</span>
                <span class="s1">} </span><span class="s0">catch </span><span class="s1">(IOException e) {</span>
                    <span class="s1">JOptionPane.showMessageDialog(ModifiedTwoPassAssemblerGUI.</span><span class="s0">this, </span><span class="s2">&quot;Error: &quot; </span><span class="s1">+ e.getMessage()</span><span class="s0">, </span><span class="s2">&quot;Error&quot;</span><span class="s0">, </span><span class="s1">JOptionPane.ERROR_MESSAGE)</span><span class="s0">;</span>
                <span class="s1">}</span>
                <span class="s0">return null;</span>
            <span class="s1">}</span>

            <span class="s1">@Override</span>
            <span class="s0">protected void </span><span class="s1">done() {</span>
                <span class="s1">assembleBtn.setEnabled(</span><span class="s0">true</span><span class="s1">)</span><span class="s0">;</span>
            <span class="s1">}</span>
        <span class="s1">}</span><span class="s0">;</span>

        <span class="s1">worker.execute()</span><span class="s0">;</span>
    <span class="s1">}</span>

    <span class="s0">private void </span><span class="s1">displayIntermediateCode(Map&lt;Integer</span><span class="s0">, </span><span class="s1">String&gt; intermediate</span><span class="s0">, </span><span class="s1">Map&lt;Integer</span><span class="s0">, </span><span class="s1">String&gt; intermediateStart) {</span>
        <span class="s1">StringBuilder content = </span><span class="s0">new </span><span class="s1">StringBuilder()</span><span class="s0">;</span>
        <span class="s0">for </span><span class="s1">(Map.Entry&lt;Integer</span><span class="s0">, </span><span class="s1">String&gt; entry : intermediateStart.entrySet()) {</span>
            <span class="s1">content.append(String.format(</span><span class="s2">&quot;%04X&quot;</span><span class="s0">, </span><span class="s1">entry.getKey())).append(entry.getValue()).append(</span><span class="s2">&quot;</span><span class="s0">\n</span><span class="s2">&quot;</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s1">}</span>
        <span class="s0">for </span><span class="s1">(Map.Entry&lt;Integer</span><span class="s0">, </span><span class="s1">String&gt; entry : intermediate.entrySet()) {</span>
            <span class="s1">content.append(String.format(</span><span class="s2">&quot;%04X&quot;</span><span class="s0">, </span><span class="s1">entry.getKey())).append(entry.getValue()).append(</span><span class="s2">&quot;</span><span class="s0">\n</span><span class="s2">&quot;</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s1">}</span>
        <span class="s1">intermediateFileOutput.setText(content.toString())</span><span class="s0">;</span>
    <span class="s1">}</span>

    <span class="s0">private void </span><span class="s1">displaySymbolTable(Map&lt;String</span><span class="s0">, </span><span class="s1">Integer&gt; symtab) {</span>
        <span class="s1">StringBuilder content = </span><span class="s0">new </span><span class="s1">StringBuilder()</span><span class="s0">;</span>
        <span class="s0">for </span><span class="s1">(Map.Entry&lt;String</span><span class="s0">, </span><span class="s1">Integer&gt; entry : symtab.entrySet()) {</span>
            <span class="s1">content.append(entry.getKey()).append(</span><span class="s2">&quot;</span><span class="s0">\t</span><span class="s2">&quot;</span><span class="s1">).append(String.format(</span><span class="s2">&quot;%04X&quot;</span><span class="s0">, </span><span class="s1">entry.getValue())).append(</span><span class="s2">&quot;</span><span class="s0">\n</span><span class="s2">&quot;</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s1">}</span>
        <span class="s1">symbolTableOutput.setText(content.toString())</span><span class="s0">;</span>
    <span class="s1">}</span>

    <span class="s0">private void </span><span class="s1">displayObjectCode(Map&lt;Integer</span><span class="s0">, </span><span class="s1">String&gt; objectCode) {</span>
        <span class="s1">StringBuilder content = </span><span class="s0">new </span><span class="s1">StringBuilder()</span><span class="s0">;</span>
        <span class="s0">for </span><span class="s1">(Map.Entry&lt;Integer</span><span class="s0">, </span><span class="s1">String&gt; entry : objectCode.entrySet()) {</span>
            <span class="s1">content.append(entry.getValue()).append(</span><span class="s2">&quot;</span><span class="s0">\n</span><span class="s2">&quot;</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s1">}</span>
        <span class="s1">objectCodeOutput.setText(content.toString())</span><span class="s0">;</span>
    <span class="s1">}</span>

    <span class="s0">public </span><span class="s1">Icon getBrowseIcon() </span><span class="s0">throws </span><span class="s1">IOException {</span>
        <span class="s1">InputStream inputStream = getClass().getClassLoader().getResourceAsStream(</span><span class="s2">&quot;browse-icon.png&quot;</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s0">if </span><span class="s1">(inputStream == </span><span class="s0">null</span><span class="s1">) {</span>
            <span class="s1">System.out.println(</span><span class="s2">&quot;Resource not found: browse-icon.png&quot;</span><span class="s1">)</span><span class="s0">;</span>
            <span class="s0">return null;</span>
        <span class="s1">}</span>
        <span class="s0">return new </span><span class="s1">ImageIcon(inputStream.readAllBytes())</span><span class="s0">;</span>
    <span class="s1">}</span>
<span class="s1">}</span>

<span class="s0">class </span><span class="s1">TwoPassAssembler {</span>
    <span class="s0">private final </span><span class="s1">String inputFile</span><span class="s0">;</span>
    <span class="s0">private final </span><span class="s1">String optabFile</span><span class="s0">;</span>
    <span class="s0">private final </span><span class="s1">Map&lt;String</span><span class="s0">, </span><span class="s1">String&gt; optab = </span><span class="s0">new </span><span class="s1">HashMap&lt;&gt;()</span><span class="s0">;</span>
    <span class="s0">private final </span><span class="s1">Map&lt;String</span><span class="s0">, </span><span class="s1">Integer&gt; symtab = </span><span class="s0">new </span><span class="s1">LinkedHashMap&lt;&gt;()</span><span class="s0">;</span>
    <span class="s0">private final </span><span class="s1">Map&lt;Integer</span><span class="s0">, </span><span class="s1">String&gt; intermediate = </span><span class="s0">new </span><span class="s1">LinkedHashMap&lt;&gt;()</span><span class="s0">;</span>
    <span class="s0">private final </span><span class="s1">Map&lt;Integer</span><span class="s0">, </span><span class="s1">String&gt; intermediateStart = </span><span class="s0">new </span><span class="s1">LinkedHashMap&lt;&gt;()</span><span class="s0">;</span>
    <span class="s0">private final </span><span class="s1">Map&lt;Integer</span><span class="s0">, </span><span class="s1">String&gt; objectCode = </span><span class="s0">new </span><span class="s1">LinkedHashMap&lt;&gt;()</span><span class="s0">;</span>
    <span class="s0">private int </span><span class="s1">locctr = </span><span class="s3">0</span><span class="s0">;</span>
    <span class="s0">private int </span><span class="s1">start = </span><span class="s3">0</span><span class="s0">;</span>
    <span class="s0">private int </span><span class="s1">length = </span><span class="s3">0</span><span class="s0">;</span>

    <span class="s0">public </span><span class="s1">TwoPassAssembler(String inputFile</span><span class="s0">, </span><span class="s1">String optabFile) {</span>
        <span class="s0">this</span><span class="s1">.inputFile = inputFile</span><span class="s0">;</span>
        <span class="s0">this</span><span class="s1">.optabFile = optabFile</span><span class="s0">;</span>
    <span class="s1">}</span>

    <span class="s0">public void </span><span class="s1">loadOptab() </span><span class="s0">throws </span><span class="s1">IOException {</span>
        <span class="s1">BufferedReader reader = </span><span class="s0">new </span><span class="s1">BufferedReader(</span><span class="s0">new </span><span class="s1">FileReader(optabFile))</span><span class="s0">;</span>
        <span class="s1">String line</span><span class="s0">;</span>
        <span class="s0">while </span><span class="s1">((line = reader.readLine()) != </span><span class="s0">null</span><span class="s1">) {</span>
            <span class="s1">String[] parts = line.split(</span><span class="s2">&quot;</span><span class="s0">\\</span><span class="s2">s+&quot;</span><span class="s1">)</span><span class="s0">;</span>
            <span class="s1">optab.put(parts[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">parts[</span><span class="s3">1</span><span class="s1">])</span><span class="s0">;</span>
        <span class="s1">}</span>
        <span class="s1">reader.close()</span><span class="s0">;</span>
    <span class="s1">}</span>

    <span class="s0">public void </span><span class="s1">passOne() </span><span class="s0">throws </span><span class="s1">IOException {</span>
        <span class="s1">BufferedReader reader = </span><span class="s0">new </span><span class="s1">BufferedReader(</span><span class="s0">new </span><span class="s1">FileReader(inputFile))</span><span class="s0">;</span>
        <span class="s1">String line = reader.readLine()</span><span class="s0">;</span>
        <span class="s1">String[] parts = line.split(</span><span class="s2">&quot;</span><span class="s0">\\</span><span class="s2">s+&quot;</span><span class="s1">)</span><span class="s0">;</span>

        <span class="s0">if </span><span class="s1">(parts[</span><span class="s3">1</span><span class="s1">].equals(</span><span class="s2">&quot;START&quot;</span><span class="s1">)) {</span>
            <span class="s1">start = Integer.parseInt(parts[</span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s3">16</span><span class="s1">)</span><span class="s0">; </span><span class="s4">// Parse start as hexadecimal</span>
            <span class="s1">locctr = start</span><span class="s0">;</span>
            <span class="s1">intermediateStart.put(locctr</span><span class="s0">, </span><span class="s1">String.format(</span><span class="s2">&quot;</span><span class="s0">\t</span><span class="s2">%s</span><span class="s0">\t</span><span class="s2">%s</span><span class="s0">\t</span><span class="s2">%s&quot;</span><span class="s0">, </span><span class="s1">parts[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">parts[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">parts[</span><span class="s3">2</span><span class="s1">]))</span><span class="s0">;</span>
            <span class="s1">line = reader.readLine()</span><span class="s0">;</span>
        <span class="s1">} </span><span class="s0">else </span><span class="s1">{</span>
            <span class="s1">locctr = </span><span class="s3">0</span><span class="s0">;</span>
        <span class="s1">}</span>

        <span class="s4">// Process each line</span>
        <span class="s0">while </span><span class="s1">(line != </span><span class="s0">null</span><span class="s1">) {</span>
            <span class="s1">parts = line.split(</span><span class="s2">&quot;</span><span class="s0">\\</span><span class="s2">s+&quot;</span><span class="s1">)</span><span class="s0">;</span>
            <span class="s0">if </span><span class="s1">(parts[</span><span class="s3">1</span><span class="s1">].equals(</span><span class="s2">&quot;END&quot;</span><span class="s1">)) </span><span class="s0">break;</span>

            <span class="s4">// Store intermediate with location counter in hex format</span>
            <span class="s1">intermediate.put(locctr</span><span class="s0">, </span><span class="s1">String.format(</span><span class="s2">&quot;</span><span class="s0">\t</span><span class="s2">%s</span><span class="s0">\t</span><span class="s2">%s</span><span class="s0">\t</span><span class="s2">%s&quot;</span><span class="s0">, </span><span class="s1">parts[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">parts[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">parts[</span><span class="s3">2</span><span class="s1">]))</span><span class="s0">;</span>

            <span class="s4">// Insert into symbol table if label exists</span>
            <span class="s0">if </span><span class="s1">(!parts[</span><span class="s3">0</span><span class="s1">].equals(</span><span class="s2">&quot;-&quot;</span><span class="s1">)) {</span>
                <span class="s1">symtab.put(parts[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">locctr)</span><span class="s0">;</span>
            <span class="s1">}</span>

            <span class="s4">// Update locctr based on the opcode</span>
            <span class="s0">if </span><span class="s1">(optab.containsKey(parts[</span><span class="s3">1</span><span class="s1">])) {</span>
                <span class="s1">locctr += </span><span class="s3">3</span><span class="s0">;</span>
            <span class="s1">} </span><span class="s0">else if </span><span class="s1">(parts[</span><span class="s3">1</span><span class="s1">].equals(</span><span class="s2">&quot;WORD&quot;</span><span class="s1">)) {</span>
                <span class="s1">locctr += </span><span class="s3">3</span><span class="s0">;</span>
            <span class="s1">} </span><span class="s0">else if </span><span class="s1">(parts[</span><span class="s3">1</span><span class="s1">].equals(</span><span class="s2">&quot;BYTE&quot;</span><span class="s1">)) {</span>
                <span class="s1">locctr += parts[</span><span class="s3">2</span><span class="s1">].length() - </span><span class="s3">3</span><span class="s0">;</span>
            <span class="s1">} </span><span class="s0">else if </span><span class="s1">(parts[</span><span class="s3">1</span><span class="s1">].equals(</span><span class="s2">&quot;RESW&quot;</span><span class="s1">)) {</span>
                <span class="s1">locctr += </span><span class="s3">3 </span><span class="s1">* Integer.parseInt(parts[</span><span class="s3">2</span><span class="s1">])</span><span class="s0">;</span>
            <span class="s1">} </span><span class="s0">else if </span><span class="s1">(parts[</span><span class="s3">1</span><span class="s1">].equals(</span><span class="s2">&quot;RESB&quot;</span><span class="s1">)) {</span>
                <span class="s1">locctr += Integer.parseInt(parts[</span><span class="s3">2</span><span class="s1">])</span><span class="s0">;</span>
            <span class="s1">}</span>

            <span class="s1">line = reader.readLine()</span><span class="s0">;</span>
        <span class="s1">}</span>

        <span class="s4">// Store final line in intermediate and calculate program length</span>
        <span class="s1">intermediate.put(locctr</span><span class="s0">, </span><span class="s1">String.format(</span><span class="s2">&quot;</span><span class="s0">\t</span><span class="s2">%s</span><span class="s0">\t</span><span class="s2">%s</span><span class="s0">\t</span><span class="s2">%s&quot;</span><span class="s0">, </span><span class="s1">parts[</span><span class="s3">0</span><span class="s1">]</span><span class="s0">, </span><span class="s1">parts[</span><span class="s3">1</span><span class="s1">]</span><span class="s0">, </span><span class="s1">parts[</span><span class="s3">2</span><span class="s1">]))</span><span class="s0">;</span>
        <span class="s1">length = locctr - start</span><span class="s0">;</span>

        <span class="s1">reader.close()</span><span class="s0">;</span>
    <span class="s1">}</span>

    <span class="s0">public void </span><span class="s1">passTwo() </span><span class="s0">throws </span><span class="s1">IOException {</span>
        <span class="s1">String line</span><span class="s0">;</span>
        <span class="s1">String[] parts</span><span class="s0">;</span>

        <span class="s1">String startLine = intermediateStart.get(start)</span><span class="s0">;</span>
        <span class="s1">String[] startParts = startLine.trim().split(</span><span class="s2">&quot;</span><span class="s0">\\</span><span class="s2">s+&quot;</span><span class="s1">)</span><span class="s0">;</span>

        <span class="s4">// Handle &quot;START&quot; directive</span>
        <span class="s0">if </span><span class="s1">(startParts[</span><span class="s3">1</span><span class="s1">].equals(</span><span class="s2">&quot;START&quot;</span><span class="s1">)) {</span>
            <span class="s1">objectCode.put(</span><span class="s3">0</span><span class="s0">, </span><span class="s2">&quot;H^ &quot; </span><span class="s1">+ startParts[</span><span class="s3">0</span><span class="s1">] + </span><span class="s2">&quot;^ &quot; </span><span class="s1">+ String.format(</span><span class="s2">&quot;%06X&quot;</span><span class="s0">, </span><span class="s1">start) + </span><span class="s2">&quot;^ &quot; </span><span class="s1">+ String.format(</span><span class="s2">&quot;%06X&quot;</span><span class="s0">, </span><span class="s1">length))</span><span class="s0">;</span>
            <span class="s4">//line = intermediate.get(start + 1);</span>
        <span class="s1">} </span><span class="s0">else </span><span class="s1">{</span>
            <span class="s1">objectCode.put(</span><span class="s3">0</span><span class="s0">, </span><span class="s2">&quot;H^ &quot; </span><span class="s1">+ </span><span class="s2">&quot; &quot; </span><span class="s1">+ </span><span class="s2">&quot;^ 0000^ &quot; </span><span class="s1">+ String.format(</span><span class="s2">&quot;%06X&quot;</span><span class="s0">, </span><span class="s1">length))</span><span class="s0">;</span>
        <span class="s1">}</span>

        <span class="s1">StringBuilder textRecord = </span><span class="s0">new </span><span class="s1">StringBuilder()</span><span class="s0">;</span>
        <span class="s0">int </span><span class="s1">textStartAddr = </span><span class="s3">0</span><span class="s0">;</span>
        <span class="s0">int </span><span class="s1">textLength = </span><span class="s3">0</span><span class="s0">;</span>

        <span class="s0">for </span><span class="s1">(</span><span class="s0">int </span><span class="s1">loc : intermediate.keySet()) {</span>

            <span class="s1">line = intermediate.get(loc)</span><span class="s0">;</span>
            <span class="s1">parts = line.trim().split(</span><span class="s2">&quot;</span><span class="s0">\\</span><span class="s2">s+&quot;</span><span class="s1">)</span><span class="s0">;</span>
            <span class="s0">if </span><span class="s1">(parts.length &lt; </span><span class="s3">3</span><span class="s1">) </span><span class="s0">continue;</span>

            <span class="s0">if </span><span class="s1">(parts[</span><span class="s3">2</span><span class="s1">].equals(</span><span class="s2">&quot;END&quot;</span><span class="s1">)) </span><span class="s0">break;</span>

            <span class="s0">if </span><span class="s1">(textLength == </span><span class="s3">0</span><span class="s1">) {</span>
                <span class="s1">textStartAddr = loc</span><span class="s0">;</span>
                <span class="s1">textRecord.append(</span><span class="s2">&quot;T^ &quot;</span><span class="s1">).append(String.format(</span><span class="s2">&quot;%06X&quot;</span><span class="s0">, </span><span class="s1">textStartAddr)).append(</span><span class="s2">&quot;^ &quot;</span><span class="s1">)</span><span class="s0">;</span>
            <span class="s1">}</span>

            <span class="s4">// Generate object code for each line</span>
            <span class="s0">if </span><span class="s1">(optab.containsKey(parts[</span><span class="s3">1</span><span class="s1">])) {</span>
                <span class="s1">String machineCode = optab.get(parts[</span><span class="s3">1</span><span class="s1">])</span><span class="s0">;</span>
                <span class="s0">int </span><span class="s1">address = symtab.getOrDefault(parts[</span><span class="s3">2</span><span class="s1">]</span><span class="s0">, </span><span class="s3">0</span><span class="s1">)</span><span class="s0">;</span>
                <span class="s1">String code = machineCode + String.format(</span><span class="s2">&quot;%04X&quot;</span><span class="s0">, </span><span class="s1">address)</span><span class="s0">;</span>
                <span class="s1">textRecord.append(code).append(</span><span class="s2">&quot;^ &quot;</span><span class="s1">)</span><span class="s0">;</span>
                <span class="s1">textLength += code.length() / </span><span class="s3">2</span><span class="s0">;</span>
            <span class="s1">} </span><span class="s0">else if </span><span class="s1">(parts[</span><span class="s3">1</span><span class="s1">].equals(</span><span class="s2">&quot;WORD&quot;</span><span class="s1">)) {</span>
                <span class="s1">String wordCode = String.format(</span><span class="s2">&quot;%06X&quot;</span><span class="s0">, </span><span class="s1">Integer.parseInt(parts[</span><span class="s3">2</span><span class="s1">]))</span><span class="s0">;</span>
                <span class="s1">textRecord.append(wordCode).append(</span><span class="s2">&quot;^ &quot;</span><span class="s1">)</span><span class="s0">;</span>
                <span class="s1">textLength += wordCode.length() / </span><span class="s3">2</span><span class="s0">;</span>
            <span class="s1">} </span><span class="s0">else if </span><span class="s1">(parts[</span><span class="s3">1</span><span class="s1">].equals(</span><span class="s2">&quot;BYTE&quot;</span><span class="s1">)) {</span>
                <span class="s1">String byteCode = parts[</span><span class="s3">2</span><span class="s1">].substring(</span><span class="s3">2</span><span class="s0">, </span><span class="s1">parts[</span><span class="s3">2</span><span class="s1">].length() - </span><span class="s3">1</span><span class="s1">)</span><span class="s0">; </span><span class="s4">// Extract value from BYTE literal</span>
                <span class="s1">textRecord.append(byteCode).append(</span><span class="s2">&quot;^ &quot;</span><span class="s1">)</span><span class="s0">;</span>
                <span class="s1">textLength += byteCode.length() / </span><span class="s3">2</span><span class="s0">;</span>
            <span class="s1">} </span><span class="s0">else if </span><span class="s1">(parts[</span><span class="s3">1</span><span class="s1">].equals(</span><span class="s2">&quot;RESW&quot;</span><span class="s1">) || parts[</span><span class="s3">1</span><span class="s1">].equals(</span><span class="s2">&quot;RESB&quot;</span><span class="s1">)) {</span>
                <span class="s4">// If we hit RESW/RESB, flush the current text record and start a new one after reserving memory</span>
                <span class="s0">if </span><span class="s1">(textLength &gt; </span><span class="s3">0</span><span class="s1">) {</span>
                    <span class="s1">objectCode.put(textStartAddr</span><span class="s0">, </span><span class="s1">textRecord.toString())</span><span class="s0">;</span>
                    <span class="s1">textRecord = </span><span class="s0">new </span><span class="s1">StringBuilder()</span><span class="s0">;</span>
                    <span class="s1">textLength = </span><span class="s3">0</span><span class="s0">;</span>
                <span class="s1">}</span>
                <span class="s0">continue; </span><span class="s4">// Do not generate object code for reserved space</span>
            <span class="s1">}</span>

            <span class="s0">if </span><span class="s1">(textLength &gt;= </span><span class="s3">30</span><span class="s1">) { </span><span class="s4">// Text records should not exceed 30 bytes (60 hex characters)</span>
                <span class="s1">objectCode.put(textStartAddr</span><span class="s0">, </span><span class="s1">textRecord.toString())</span><span class="s0">;</span>
                <span class="s1">textRecord = </span><span class="s0">new </span><span class="s1">StringBuilder()</span><span class="s0">;</span>
                <span class="s1">textLength = </span><span class="s3">0</span><span class="s0">;</span>
            <span class="s1">}</span>
        <span class="s1">}</span>

        <span class="s4">// Write remaining text record if not empty</span>
        <span class="s0">if </span><span class="s1">(textLength &gt; </span><span class="s3">0</span><span class="s1">) {</span>
            <span class="s1">objectCode.put(textStartAddr</span><span class="s0">, </span><span class="s1">textRecord.toString())</span><span class="s0">;</span>
        <span class="s1">}</span>

        <span class="s4">// Write End record</span>
        <span class="s1">objectCode.put(locctr</span><span class="s0">, </span><span class="s2">&quot;E^ &quot; </span><span class="s1">+ String.format(</span><span class="s2">&quot;%06X&quot;</span><span class="s0">, </span><span class="s1">start))</span><span class="s0">;</span>
    <span class="s1">}</span>


    <span class="s0">public </span><span class="s1">Map&lt;Integer</span><span class="s0">, </span><span class="s1">String&gt; getIntermediate() {</span>
        <span class="s0">return </span><span class="s1">intermediate</span><span class="s0">;</span>
    <span class="s1">}</span>

    <span class="s0">public </span><span class="s1">Map&lt;Integer</span><span class="s0">, </span><span class="s1">String&gt; getIntermediateStart() {</span>
        <span class="s0">return </span><span class="s1">intermediateStart</span><span class="s0">;</span>
    <span class="s1">}</span>

    <span class="s0">public </span><span class="s1">Map&lt;String</span><span class="s0">, </span><span class="s1">Integer&gt; getSymtab() {</span>
        <span class="s0">return </span><span class="s1">symtab</span><span class="s0">;</span>
    <span class="s1">}</span>

    <span class="s0">public </span><span class="s1">Map&lt;Integer</span><span class="s0">, </span><span class="s1">String&gt; getObjectCode() {</span>
        <span class="s0">return </span><span class="s1">objectCode</span><span class="s0">;</span>
    <span class="s1">}</span>

<span class="s1">}</span>

<span class="s0">public class </span><span class="s1">Main {</span>
    <span class="s0">public static void </span><span class="s1">main(String[] args) {</span>
        <span class="s1">SwingUtilities.invokeLater(() -&gt; {</span>
            <span class="s1">ModifiedTwoPassAssemblerGUI gui</span><span class="s0">;</span>
            <span class="s0">try </span><span class="s1">{</span>
                <span class="s1">gui = </span><span class="s0">new </span><span class="s1">ModifiedTwoPassAssemblerGUI()</span><span class="s0">;</span>
            <span class="s1">} </span><span class="s0">catch </span><span class="s1">(IOException e) {</span>
                <span class="s0">throw new </span><span class="s1">RuntimeException(e)</span><span class="s0">;</span>
            <span class="s1">}</span>
            <span class="s1">gui.setVisible(</span><span class="s0">true</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s1">})</span><span class="s0">;</span>
    <span class="s1">}</span>
<span class="s1">}</span></pre>
</body>
</html>